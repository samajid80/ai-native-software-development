# Implementation Plan: Chapter 5 (Claude Code) Refinement

**Branch**: `029-chapter-5-refinement` | **Date**: 2025-01-17 | **Spec**: [spec.md](./spec.md)

**Input**: Feature specification + Current state research from `research.md`

---

## Summary

Transform Chapter 5 from a **feature documentation** approach (explaining what Claude Code does) into a **methodology-driven learning experience** (teaching AI-native development paradigm through Claude Code).

Refinement is **surgical** (preserve working content, exercises, structure) focusing on:
- **Metadata enhancement**: Add 3 missing fields to enable pedagogical tracking
- **Content conciseness**: Reduce 2 verbose lessons (Lessons 6 & 9) while preserving substance
- **Methodology framing**: Make implicit "Why This Matters" sections explicit in 5 lessons
- **Three Roles strengthening**: Enhance AI collaboration demonstrations in 4 lessons
- **Stage progression visibility**: Document L1→L2→L3→L4 progression in README and lesson metadata
- **Factual accuracy validation**: Sandbox-test all code examples and commands

---

## Technical Context

**Language/Version**: Markdown (Docusaurus-compatible) + YAML frontmatter

**Current Project Type**: Educational content (9 interconnected lessons)

**Current Structure**:
```
book-source/docs/02-AI-Tool-Landscape/05-claude-code-features-and-workflows/
├── README.md
├── 01-origin-story.md (169 lines, L1)
├── 02-installation-and-authentication.md (289 lines, L1)
├── 03-claude-md-context-files.md (376 lines, L2)
├── 04-mcp-integration.md (225 lines, L2)
├── 05-subagents-and-orchestration.md (355 lines, L2)
├── 06-agent-skills.md (547 lines, L2) ⚠️ EXCEEDS 400-line limit
├── 07-hooks-and-extensibility.md (260 lines, L2)
├── 08-settings-hierarchy.md (331 lines, L3)
└── 09-plugins-putting-it-all-together.md (744 lines, L4) ⚠️ EXCEEDS 400-line limit
Total: 3,332 lines | 9 lessons | Target audience: A2-B1
```

**Target Proficiency**: A2-B1 (beginner to intermediate)

**Performance Goals**:
- All lessons 250-350 lines (avg 300)
- Theory-to-practice ratio ≥60% hands-on
- Cognitive load ≤7 concepts (A2), ≤10 (B1)

**Constraints**:
- Preserve existing exercises (high-quality)
- Preserve Lesson 3 Three Roles example (excellence reference)
- Preserve Lesson 9 skill reference material (user-approved)
- Maintain Docusaurus compatibility
- No new lessons (9 is correct scope)

---

## Constitution Check

✅ **Specification Primacy**: Spec defines measurable success criteria (SC1-SC7, FR1-FR7, AC1-AC7)

✅ **Progressive Complexity**: A2-B1 tier limits enforced (≤7-10 concepts per lesson)

✅ **Factual Accuracy**: Validation protocol specified (sandbox audit, citation requirement)

✅ **Coherent Pedagogical Structure**: L1→L2→L3→L4 progression explicit in spec

✅ **Intelligence Accumulation**: Each lesson builds toward capstone plugin composition

✅ **Anti-Convergence**: Spec prevents generic "enhance all lessons equally" approach (surgical targeting)

✅ **Minimal Content**: Spec defines non-goals (don't add lessons, don't become comprehensive reference docs)

**Status**: GATE PASSES. Proceed to implementation planning.

---

## Project Structure

### Documentation (Specifications)
```
specs/029-chapter-5-refinement/
├── spec.md                 # Feature specification (complete)
├── plan.md                 # This file (lesson-by-lesson strategy)
├── research.md             # Phase 0 findings (complete)
├── data-model.md           # N/A (content refinement, not software)
├── quickstart.md           # N/A (content refinement, not software)
├── tasks.md                # TBD (generated by /sp.tasks)
└── contracts/              # N/A (content refinement, not software)
```

### Source Code (Chapter Content)
```
book-source/docs/02-AI-Tool-Landscape/05-claude-code-features-and-workflows/
├── README.md               # MODIFY: Add Stage Progression section
├── 01-origin-story.md      # MODIFY: Add metadata fields
├── 02-installation-and-authentication.md  # MODIFY: Add metadata + "Why This Matters"
├── 03-claude-md-context-files.md         # MODIFY: Add metadata
├── 04-mcp-integration.md                 # MODIFY: Add metadata + "Why This Matters" + enhance Three Roles
├── 05-subagents-and-orchestration.md     # MODIFY: Add metadata + "Why This Matters" + Three Roles
├── 06-agent-skills.md                    # CRITICAL: Reduce 39% (547→350 lines) + add metadata + "Why This Matters"
├── 07-hooks-and-extensibility.md         # MODIFY: Add metadata + enhance Three Roles
├── 08-settings-hierarchy.md              # MODIFY: Add metadata + strengthen "Why This Matters"
└── 09-plugins-putting-it-all-together.md # CRITICAL: Reduce 47% (744→350-400 lines) + add metadata
```

---

## Lesson-by-Lesson Refinement Strategy

### LESSON 1: Origin Story (L1: Manual Foundation)

**Current State**:
- 169 lines, conceptual foundation
- ✅ Clear paradigm shift explanation (passive vs agentic AI)
- ✅ Terminal integration importance explained
- ✅ Strong "Why This Matters" section
- ⚠️ No metadata fields (stage, prerequisites, concept_count)

**Metadata Enhancement**:
```yaml
stage: "L1"  # NEW
prerequisites:  # NEW
  - "Understanding of what AI is and basic terminal usage"
concept_count: 5  # NEW
```

**Content Refinement Strategy**: MINIMAL
- Content is concise, conceptually sound
- Preserve entire lesson as-is
- Line count (169) well under limit
- No content transformation needed

**Validation Criteria**:
- ✅ Metadata fields present and correctly typed
- ✅ Stage: "L1" consistent with README
- ✅ Concept count verified (5 distinct concepts)

**Estimated Effort**: 5 minutes (metadata addition only)

---

### LESSON 2: Installation & Authentication (L1: Manual Foundation)

**Current State**:
- 289 lines, practical walkthrough
- ✅ 4 installation methods clearly presented
- ✅ 2 authentication paths with decision tree
- ✅ Security best practices included
- ❌ No explicit "Why This Matters" section
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L1"  # NEW
prerequisites:  # NEW
  - "Terminal access (Windows/macOS/Linux)"
  - "Claude account (Claude.ai or Console API)"
concept_count: 8  # NEW — Slightly elevated but acceptable with ±1 margin
```

**Content Refinement Strategy**: ADD METHODOLOGY FRAMING
- **Add new section** after intro: "Why This Matters: Terminal Integration for AI Workflows"
  - **Content** (80-120 words):
    - Explains why terminal-based AI is different from web-based (integrated, context-aware, file-system native)
    - Connects to AI-driven development paradigm (removes friction between intent and execution)
    - Links to Lesson 1 paradigm shift (terminal integration IS the agentic difference)
  - **Placement**: After "From Concept to Reality" intro, before "Prerequisites"

- No content deletion needed (289 lines acceptable; reducing to ~270-280 preferable)
- Lean toward conciseness in examples (keep CLI commands intact, trim explanatory prose)

**Code Example Validation**:
- ✅ Installation commands present (4 methods)
- ❌ Not verified in sandbox
- Action: Execute all 4 installation methods in clean environment, verify `claude --version` output

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ "Why This Matters" section added (80-120 words, methodology-focused)
- ✅ All CLI commands verified working
- ✅ Line count reduced to ~270-280 (vs current 289)

**Estimated Effort**: 30 minutes (new section + light content pruning + command verification)

---

### LESSON 3: CLAUDE.md Context Files (L2: AI Collaboration)

**Current State**:
- 376 lines, strong pedagogical design
- ✅ EXCELLENT Three Roles demonstration (preserve verbatim):
  - AI as Teacher (suggests missing sections)
  - AI as Student (you teach custom patterns)
  - AI as Co-Worker (convergence on directory structure)
- ✅ Clear "Why This Matters: Context as Productivity"
- ✅ Edge cases documented
- ✅ Verification workflow included
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L2"  # NEW
prerequisites:  # NEW
  - "Lesson 2: Claude Code installed and authenticated"
  - "Understanding of project directory structure basics"
concept_count: 6  # NEW
```

**Content Refinement Strategy**: PRESERVE + MINIMAL ENHANCEMENT
- ✅ **DO NOT MODIFY** existing Three Roles section (it's reference-quality)
- ✅ **DO NOT MODIFY** existing CLAUDE.md structure explanation
- ⚠️ **OPTIONAL**: Consider adding 1 sentence to "Why This Matters" connecting to Lesson 5+ (subagents/skills inherit context from CLAUDE.md)
- Trim any redundant explanations if line count exceeds 350 after metadata addition

**Code Example Validation**:
- ✅ Generation prompts present
- ❌ Not verified in sandbox
- Action: Test Claude Code prompt in clean project, verify CLAUDE.md generation accuracy

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ Three Roles demonstration preserved exactly
- ✅ Line count ≤350 (currently 376, may need light trim if +metadata adds)
- ✅ Generation prompt verified working

**Estimated Effort**: 20 minutes (metadata + optional enhancement + verification)

---

### LESSON 4: MCP Integration (L2: AI Collaboration)

**Current State**:
- 225 lines, hands-on workflows
- ✅ Two practical MCP workflows (Playwright web browsing, Context7 doc fetching)
- ✅ Security context included
- ❌ No explicit "Why This Matters" section (implicit in workflows)
- ❌ Limited Three Roles demonstration (mostly one-way prompts)
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L2"  # NEW
prerequisites:  # NEW
  - "Lessons 2-3: Claude Code working, CLAUDE.md understanding"
  - "Understanding of external APIs and web services"
concept_count: 6  # NEW
```

**Content Refinement Strategy**: ENHANCE METHODOLOGY + THREE ROLES
- **Add new section** after MCP definition: "Why This Matters: Safe External Integration"
  - **Content** (80-120 words):
    - Explains MCP as safe, standardized way to give AI external access
    - Connects to AI-driven development (AI can now reach beyond local files)
    - Frames as bridge between local context (CLAUDE.md from L3) and external knowledge
  - **Placement**: After "Think of MCP Like This", before "What Is MCP?"

- **Enhance Three Roles demonstration**: Add 1 explicit co-learning cycle
  - **Location**: In "Try With AI" section, add new prompt:
    ```
    Prompt: "You've successfully added Playwright MCP. Now, ask Claude Code to:
    1. Browse a website related to YOUR project (if web-based)
    2. Extract specific information you actually need
    3. Refine the extraction based on feedback

    Notice the collaboration: You describe intent, Claude explores, you refine based on results."
    ```
  - **Purpose**: Makes implicit co-learning explicit (AI explores, student refines, convergence on answer)

- **Line count**: Currently 225 (well under 400), new section adds ~100 lines → ~325 total (acceptable)

**Code Example Validation**:
- ✅ MCP add commands present
- ❌ Not verified in sandbox
- Action: Execute MCP add commands, verify `claude mcp list` shows registered servers

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ "Why This Matters" section added (80-120 words)
- ✅ One Three Roles demonstration added (explicit co-learning cycle)
- ✅ MCP commands verified working
- ✅ Line count ≤350

**Estimated Effort**: 40 minutes (new section + Three Roles cycle + command verification)

---

### LESSON 5: Subagents & Orchestration (L2: AI Collaboration)

**Current State**:
- 355 lines, clear subagent explanation
- ✅ Plan subagent well-explained
- ✅ Execution model clear (one task, one completion)
- ✅ Hands-on subagent creation workflow present
- ❌ No explicit "Why This Matters" section
- ❌ Limited Three Roles demonstration (mostly one-way instruction)
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L2"  # NEW
prerequisites:  # NEW
  - "Lessons 2-4: Claude Code, CLAUDE.md, MCP understanding"
  - "Understanding of problem decomposition"
concept_count: 6  # NEW
```

**Content Refinement Strategy**: ENHANCE METHODOLOGY + THREE ROLES
- **Add new section** after subagent definition: "Why This Matters: Specialized Expertise"
  - **Content** (80-120 words):
    - Explains subagents as team of specialists, cleaner context management
    - Connects to AI-driven development (orchestration pattern)
    - Frames as organizational intelligence (delegating to specialists)
  - **Placement**: After "What Are Subagents?", before "The Plan Subagent"

- **Enhance Three Roles**: Add 1 explicit co-learning cycle in hands-on section
  - **Location**: After Step 2 (Choose location), add new step:
    ```
    ### Step 2.5: Co-learn Subagent Design (Optional but Recommended)

    Before finalizing your subagent, ask Claude Code:
    ```
    "I'm about to create a [purpose] subagent. Before I finalize it,
    help me think through: What are 3 core decisions this subagent needs
    to make autonomously? What questions should it ask users?"
    ```

    Claude suggests patterns you might not have considered.
    You refine based on your needs.
    Together, you converge on a better subagent design.
    ```
  - **Purpose**: Demonstrates AI teaches, student refines, convergence

- **Line count**: Currently 355, new sections add ~120 lines → ~475 total (exceeds 400 slightly)
- **Mitigation**: Streamline "More Subagent Ideas" section from examples-heavy to concept-focused (saves ~30-40 lines)

**Code Example Validation**:
- ✅ `/agents` workflow shown
- ❌ Not verified in sandbox
- Action: Execute `/agents` workflow, verify interface and agent creation

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ "Why This Matters" section added (80-120 words)
- ✅ One Three Roles cycle added (design co-learning)
- ✅ "More Subagent Ideas" streamlined to maintain line count
- ✅ `/agents` workflow verified
- ✅ Line count ≤400

**Estimated Effort**: 45 minutes (new section + Three Roles + streamlining + verification)

---

### LESSON 6: Agent Skills (L2: AI Collaboration) — CRITICAL REDUCTION

**Current State**:
- 547 lines, technically comprehensive but VERBOSE
- **EXCEEDS 400-line limit by 37% (critical issue)**
- ✅ Skill architecture explained (Level 1/2/3 system)
- ✅ Skills vs subagents comparison detailed
- ✅ Skill creation workflow shown
- ❌ No explicit "Why This Matters" section
- ❌ Limited Three Roles demonstration
- ⚠️ Excessive explanation of architectural details
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L2"  # NEW
prerequisites:  # NEW
  - "Lessons 2-5: Claude Code, CLAUDE.md, MCP, Subagents"
  - "Understanding of reusable components"
concept_count: 7  # NEW — At A2 ceiling
```

**Content Refinement Strategy**: SIGNIFICANT REDUCTION (39% cut target)

**Target**: Reduce 547 → 330 lines (~217 lines cut = 39% reduction)

**How to Cut 217 Lines**:

1. **Compress "How Skills Differ from Subagents"** (~100 lines to ~40 lines)
   - Current: Detailed explanation + full comparison table + 3 paragraphs of context isolation details
   - Target: Keep comparison table, remove redundant paragraphs, trust table to show differences
   - Lines saved: ~60

2. **Simplify "Three-Level Architecture"** (~150 lines to ~80 lines)
   - Current: Full explanation of each level + real example (PDF skill) + flow diagram
   - Target: Brief summary per level, replace detailed example with single sentence ("See `.claude/skills/` directory")
   - Move detailed architecture to appendix note (not in lesson)
   - Lines saved: ~70

3. **Streamline "When Claude Code Invokes Skills"** (~80 lines to ~50 lines)
   - Current: Three patterns with detailed explanations
   - Target: Keep patterns, remove verbose explanations, use bullet points
   - Lines saved: ~30

4. **Consolidate "Try With AI" Prompts** (~60 lines to ~40 lines)
   - Current: 3-4 detailed prompts with full context
   - Target: Keep 2 most essential prompts, condense explanations
   - Lines saved: ~20

5. **Trim "Hands-On: Create Your First Skill"** (~60 lines to ~45 lines)
   - Current: Step-by-step with verbose file structure explanations
   - Target: Keep step names, reduce descriptive prose
   - Lines saved: ~15

6. **Remove Redundant Sections** (~40 lines)
   - Identify duplicate concepts between skills vs subagents section
   - Cut duplicates
   - Lines saved: ~40

**Additional Content Changes**:

- **Add "Why This Matters: Reusable Organizational Capability"** (NEW, ~100 words)
  - Explains skills as accumulated organizational intelligence
  - Connects to capstone (plugins = composed skills)
  - Placement: After skill definition, before "How Skills Differ"

- **Add One Three Roles Example** (NEW, ~80 words)
  - Location: In hands-on section
  - Scenario: "Ask Claude to review your skill design; Claude suggests improvement; you adapt"
  - Purpose: Demonstrates co-learning

**Net Change**: -217 lines (cuts) + 100 lines ("Why This Matters") + 80 lines (Three Roles) = -37 lines net
**Target Line Count**: 330-340 lines (well under 400 limit, acceptable)

**Code Example Validation**:
- ⚠️ SKILL.md structure shown but overly detailed
- ❌ Not verified in sandbox
- Action: Create test SKILL.md in `.claude/skills/`, verify Claude discovery and invocation

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ Line count reduced to 330-340 (vs 547)
- ✅ "Why This Matters" section added
- ✅ One Three Roles example added
- ✅ Skill creation still clear and actionable (preserve walkthrough)
- ✅ SKILL.md structure verified working
- ✅ Content essential to learning objectives preserved

**Estimated Effort**: 90 minutes (significant reduction requires careful surgery)

---

### LESSON 7: Hooks & Extensibility (L2: AI Collaboration)

**Current State**:
- 260 lines, practical and concise
- ✅ Hook events clearly defined (PreToolUse, PostToolUse, SessionStart, SessionEnd)
- ✅ Real-world scenarios provided
- ✅ "Why Hooks Matter for Professional Workflows" section present (good methodology framing)
- ✅ Hands-on hook creation workflow
- ❌ Limited Three Roles demonstration (mostly manual JSON editing)
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L2"  # NEW
prerequisites:  # NEW
  - "Lessons 2-6: Claude Code, CLAUDE.md, MCP, Subagents, Skills"
  - "Understanding of event-driven automation"
concept_count: 5  # NEW
```

**Content Refinement Strategy**: ENHANCE THREE ROLES
- **Strengthen Three Roles demonstration**: Add explicit co-learning prompt
  - **Location**: After Step 4 (Make It More Useful)
  - **New Step 5: Co-Design Your Hook**
    ```
    ### Step 5: Co-Design a Hook for Your Workflow (Optional)

    Now ask Claude Code:
    ```
    "I want to create a hook that automates [YOUR SPECIFIC TASK].
    What event should trigger it? What command should run?
    What should I watch out for?"
    ```

    Claude suggests appropriate hook design.
    You refine based on your needs.
    Together you create a useful automation.
    ```
  - **Purpose**: Makes three-roles explicit (AI teaches patterns, student provides context, convergence on solution)

- No content deletion needed (260 lines is lean, acceptable)
- Enhance "Why This Matters" slightly if possible without expanding

**Code Example Validation**:
- ✅ Hook JSON configurations shown
- ❌ Not verified in sandbox
- Action: Create test `.claude/settings.json` with hook, restart Claude Code, verify hook execution

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ Three Roles co-design step added (makes AI collaboration explicit)
- ✅ Hook configurations verified working
- ✅ Line count acceptable (≤300)

**Estimated Effort**: 35 minutes (add Three Roles step + verification)

---

### LESSON 8: Settings Hierarchy (L3: Intelligence Design)

**Current State**:
- 331 lines, clear hierarchy explanation
- ✅ Three settings levels clearly defined
- ✅ Precedence rules explicit
- ✅ Use cases per level documented
- ⚠️ "Why This Matters" section weak (only Expert Insight, not explicit section)
- ⚠️ Missing connection to organizational/team intelligence
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L3"  # NEW (unique: L3 without creating new skill, understanding configuration as organizational pattern)
prerequisites:  # NEW
  - "Lessons 2-7: All prior Claude Code features understood"
  - "Understanding of configuration management and team coordination"
concept_count: 5  # NEW
```

**Content Refinement Strategy**: ENHANCE METHODOLOGY FRAMING
- **Strengthen "Why This Matters" section**: Replace weak Expert Insight with explicit section
  - **New Section**: "Why Settings Hierarchy Matters for Team Intelligence"
  - **Location**: After "The Three Settings Levels", before "Precedence"
  - **Content** (120-150 words):
    - Explains settings hierarchy as enabling team collaboration without conflicts
    - Frames as organizational intelligence (team standards, personal customization, local experimentation)
    - Connects to Lesson 3 (CLAUDE.md) and Lesson 6 (Skills) — persistent context at multiple levels
    - Links to L4 (Plugins) — shared plugins configured at appropriate hierarchy level
    - Positions settings as foundation for composable, reusable intelligence
  - **Tone**: Methodology-focused, not technical reference

- No content deletion needed (331 lines, lean)
- Consider moving detailed precedence table to separate section if it expands line count

**Code Example Validation**:
- ✅ Settings file paths shown
- ✅ Example JSON configurations present
- ❌ Not verified in sandbox
- Action: Create `~/.claude/settings.json`, `.claude/settings.json`, `.claude/settings.local.json`, verify precedence behavior

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ "Why This Matters" section strengthened (explicit organizational framing)
- ✅ Settings files and precedence verified working
- ✅ Line count acceptable (≤350)

**Estimated Effort**: 40 minutes (add methodology section + verification)

---

### LESSON 9: Plugins (L4: Spec-Driven Composition) — CRITICAL REDUCTION

**Current State**:
- 744 lines, comprehensive reference material
- **EXCEEDS 400-line limit by 86% (CRITICAL ISSUE)**
- ✅ Plugin definition clear (bundled capabilities)
- ✅ Plugin components listed
- ✅ Skills marketplace described
- ✅ Installation methods shown
- ⚠️ Exhaustive marketplace catalog (example-skills vs document-skills with many sub-items)
- ❌ Limited focus on hands-on plugin usage
- ❌ No explicit "Why This Matters" for composition pattern
- ⚠️ Repetitive examples and descriptions
- ⚠️ No metadata fields

**Metadata Enhancement**:
```yaml
stage: "L4"  # NEW
prerequisites:  # NEW
  - "Lessons 1-8: Complete understanding of all Claude Code features"
  - "Understanding of composition and orchestration"
concept_count: 8  # NEW
```

**Content Refinement Strategy**: MAJOR REDUCTION (47% cut target)

**Target**: Reduce 744 → 350-400 lines (~344-394 lines cut = 46-47% reduction)

**How to Cut 344 Lines**:

1. **Eliminate Exhaustive Marketplace Catalog** (~150 lines to ~40 lines)
   - Current: Lists all skills in example-skills and document-skills bundles (50+ items described)
   - Target: Mention 2-3 representative examples (canvas design, web testing, document processing), note "many more available"
   - Lines saved: ~110

2. **Simplify Plugin Discovery Section** (~80 lines to ~40 lines)
   - Current: Detailed workflow for browsing marketplace with step-by-step UI navigation
   - Target: One simple command `/plugin`, note that UI guides you; let users explore
   - Lines saved: ~40

3. **Consolidate Installation Methods** (~60 lines to ~35 lines)
   - Current: Two methods (UI + CLI) with full explanations
   - Target: UI method as primary, CLI as alternative (single sentence)
   - Lines saved: ~25

4. **Replace Exhaustive "Test Your Installed Skills"** (~100 lines to ~50 lines)
   - Current: Multiple detailed workflow examples
   - Target: One concrete example (canvas design for diagram), encourage exploration
   - Lines saved: ~50

5. **Streamline "Recognizing When Plugins Solve Your Needs"** (~80 lines to ~40 lines)
   - Current: Many decision scenarios
   - Target: Single clear decision framework (when plugin worth installing vs building)
   - Lines saved: ~40

6. **Trim "Understanding Plugin Architecture"** (~60 lines to ~30 lines)
   - Current: Detailed explanation of how plugins bundle components
   - Target: Single diagram + brief text; assume students understand from prior lessons
   - Lines saved: ~30

7. **Remove Redundancy** (~40 lines)
   - Identify repeated explanations (plugin definition appears multiple times)
   - Consolidate into single explanation
   - Lines saved: ~40

8. **Reduce "Try With AI" Prompts** (~80 lines to ~40 lines)
   - Current: 3-4 detailed prompts
   - Target: Keep 2 most essential prompts
   - Lines saved: ~40

**Additional Content Changes**:

- **Add "Why This Matters: Composition as Organizational Practice"** (NEW, ~120 words)
  - Explicitly connects plugins to chapter arc (everything from L1-L3 composes into plugins)
  - Explains plugins as embodiment of methodology (spec-driven, reusable intelligence, extensible workflows)
  - Frames capstone as integration point
  - Placement: Early, after plugin definition

- **Preserve**: Lesson 9 skill reference material (user-approved keep)
  - Advanced skill creation guide, MCP building guide stay intact

- **Refocus entire lesson**: From "comprehensive marketplace reference" to "how to discover and use existing plugins"
  - Remove: Exhaustive catalog
  - Keep: Hands-on plugin installation, testing, usage

**Net Change**: -344 lines (cuts) + 120 lines ("Why This Matters") = -224 lines net
**Target Line Count**: 520 → 350-400 lines (well under 400 limit, appropriate for capstone)

**Code Example Validation**:
- ❌ `/plugin marketplace add` command not verified
- ❌ `/plugin` workflow not tested
- ❌ Plugin installation not executed
- Action: Execute plugin marketplace commands, install example-skills, test skill discovery

**Validation Criteria**:
- ✅ Metadata fields correct
- ✅ Line count reduced to 350-400 (from 744)
- ✅ "Why This Matters" composition section added
- ✅ Focus shifted to hands-on usage (vs exhaustive reference)
- ✅ Marketplace examples remain but not exhaustive
- ✅ Skill reference material preserved
- ✅ Plugin commands verified working
- ✅ Capstone effectively integrates L1-L8 concepts

**Estimated Effort**: 120 minutes (MAJOR reduction requires careful restructuring)

---

### README: Stage Progression Documentation

**Current State**:
- ✅ Clear chapter title and overview
- ✅ "What You'll Learn" describes all 9 lessons
- ❌ No explicit "Stage Progression" section
- ❌ No visual representation
- ❌ No rationale for lesson grouping

**Refinement Strategy**: ADD STAGE PROGRESSION SECTION

**New Section** (to add after current "What You'll Learn" section):

```markdown
## Stage Progression: L1→L2→L3→L4

This chapter follows the **4-Layer Teaching Method**, where each lesson builds your capabilities progressively:

### Stage 1: Manual Foundation (Lessons 1-2)
**What**: Understand agentic AI and get Claude Code working on your machine
**Why**: You need to see how Claude Code differs from passive AI before we add complexity
**Lessons**:
- Lesson 1: Origin story and paradigm shift (mental model)
- Lesson 2: Installation and authentication (working tool)

### Stage 2: AI Collaboration (Lessons 3-7)
**What**: Learn each major feature while collaborating with Claude Code
**Why**: Each feature is more powerful with hands-on practice and Three Roles co-learning (AI teaches, you teach, convergence)
**Lessons**:
- Lesson 3: CLAUDE.md (persistent context — foundation for everything else)
- Lesson 4: MCP (external integrations via safe protocols)
- Lesson 5: Subagents (specialized assistants for complex tasks)
- Lesson 6: Skills (reusable capabilities you design)
- Lesson 7: Hooks (event-driven automation)

### Stage 3: Intelligence Design (Lesson 8)
**What**: Understand how to organize Claude Code for teams
**Why**: Configuration hierarchy enables shared standards (team settings) + personal customization (local settings)
**Lesson**:
- Lesson 8: Settings hierarchy (user/project/local precedence)

### Stage 4: Spec-Driven Integration (Lesson 9)
**What**: Discover and use plugins that compose everything from Lessons 1-8
**Why**: Capstone demonstrates that plugins = bundled skills + subagents + hooks + MCP = reusable organizational intelligence
**Lesson**:
- Lesson 9: Plugins from marketplace (composition pattern)

## How to Use This Chapter

**If you're new to Claude Code**: Follow Lessons 1-9 in order. Each builds on the previous.

**If you already have Claude Code**: Start with Lesson 3 (CLAUDE.md) to unlock context management, then choose features (Lessons 4-7) based on your workflow needs.

**If you're evaluating Claude Code for your team**: Review Lesson 8 (Settings) for team collaboration patterns and Lesson 9 (Plugins) for ecosystem extensibility.
```

**Visual Diagram** (optional, but recommended):
```markdown
## Visual Stage Progression

```
┌─────────────────────────────────────────────────┐
│ Stage 1: Manual Foundation (Lessons 1-2)       │
│ ═════════════════════════════════════════════  │
│ Paradigm Shift → Installation & Setup          │
│ (Mental model + working tool)                   │
└──────────────┬──────────────────────────────────┘
               ↓
┌─────────────────────────────────────────────────┐
│ Stage 2: AI Collaboration (Lessons 3-7)        │
│ ═════════════════════════════════════════════  │
│ Context → External APIs → Subagents →          │
│ Skills → Event Automation                       │
│ (Each lesson: AI teaches, you teach,           │
│  together convergence)                         │
└──────────────┬──────────────────────────────────┘
               ↓
┌─────────────────────────────────────────────────┐
│ Stage 3: Intelligence Design (Lesson 8)        │
│ ═════════════════════════════════════════════  │
│ Settings Hierarchy: Personal + Team + Local    │
│ (Organizational capability configuration)      │
└──────────────┬──────────────────────────────────┘
               ↓
┌─────────────────────────────────────────────────┐
│ Stage 4: Spec-Driven Composition (Lesson 9)    │
│ ═════════════════════════════════════════════  │
│ Plugins = Skills + Subagents + Hooks + MCP     │
│ (Reusable organizational intelligence)         │
└─────────────────────────────────────────────────┘
```

**Validation Criteria**:
- ✅ Stage grouping explicit (L1-2, L3-7, L8, L9)
- ✅ Rationale for grouping explained (not just listed)
- ✅ Visual diagram added or described
- ✅ Cross-referencing guidance ("start here if you already know X")
- ✅ README stage mapping matches lesson metadata `stage` fields

**Estimated Effort**: 30 minutes (write section + create diagram)

---

## Implementation Sequencing

### Optimal Execution Order (Minimize Risk)

**Phase 1: Metadata Enhancement (LOW RISK)** — 2-3 hours
1. Add `stage`, `prerequisites`, `concept_count` to all 9 lessons
2. Validate YAML syntax
3. Verify no changes to lesson content

**Phase 2: Easy Content Refinement (LOW-MEDIUM RISK)** — 3-4 hours
1. Lesson 1: Metadata only (5 min)
2. Lesson 2: Add "Why This Matters" + light pruning (30 min)
3. Lesson 3: Metadata + optional enhancement (20 min)
4. Lesson 7: Add Three Roles step (35 min)
5. Lesson 8: Strengthen "Why This Matters" (40 min)
6. README: Add Stage Progression section (30 min)

**Phase 3: Medium Refinement (MEDIUM RISK)** — 3-4 hours
1. Lesson 4: Add "Why This Matters" + Three Roles example (40 min)
2. Lesson 5: Add "Why This Matters" + Three Roles + streamline (45 min)

**Phase 4: Critical Reduction (HIGH RISK) — PLAN CAREFULLY** — 4-5 hours
1. Lesson 6: Reduce 39% (547→330 lines) — SURGICAL, preserve learning objectives (90 min)
2. Lesson 9: Reduce 47% (744→350-400 lines) — RESTRUCTURE, focus on hands-on (120 min)
3. Validation: Verify both lessons still cover success criteria from spec

**Phase 5: Validation & Verification (MEDIUM RISK)** — 4-5 hours
1. Sandbox audit: Test all code examples, CLI commands, workflows
2. Create SANDBOX-AUDIT-REPORT.md documenting all tests
3. Verify metadata consistency across all files
4. Cross-reference README stage mapping with lesson metadata

**Total Estimated Effort**: 14-19 hours (distributed across 5 phases)

---

## Dependencies & Risk Mitigation

### Upstream Dependencies
- ✅ Chapters 1-4 content (completed)
- ✅ Spec approval (complete, this plan is driven by spec)
- ❌ Claude Code CLI tools must work (will verify in Phase 5)

### Critical Success Factors
1. **Lesson 6 & 9 reduction must preserve learning outcomes** (not just delete text)
2. **Three Roles examples must be authentic co-learning**, not contrived
3. **Sandbox verification must catch command/workflow failures** before publication
4. **"Why This Matters" sections must be methodology-focused**, not feature sales pitches

### Risk Mitigation Strategies

| Risk | Likelihood | Impact | Mitigation |
|------|-----------|--------|-----------|
| Lesson 6/9 reduction loses essential content | Medium | High | Phase 4: Multiple review passes, cross-check against learning objectives |
| Metadata changes break Docusaurus build | Low | High | Test in local build after Phase 1 |
| Code examples fail in sandbox | Medium | Medium | Phase 5: Comprehensive testing protocol |
| "Why This Matters" sections feel forced | Medium | Medium | Have pedagogical-designer review prose quality |
| Three Roles examples lack authenticity | Low | Medium | Review against constitution's Three Roles definition |
| Stage progression diagram unclear | Low | Low | User test diagram with representative reader |

---

## Deliverables Checklist

### Phase 1: Metadata (Target: All 9 lessons)
- [ ] Lesson 01: Add stage/prerequisites/concept_count
- [ ] Lesson 02: Add stage/prerequisites/concept_count
- [ ] Lesson 03: Add stage/prerequisites/concept_count
- [ ] Lesson 04: Add stage/prerequisites/concept_count
- [ ] Lesson 05: Add stage/prerequisites/concept_count
- [ ] Lesson 06: Add stage/prerequisites/concept_count
- [ ] Lesson 07: Add stage/prerequisites/concept_count
- [ ] Lesson 08: Add stage/prerequisites/concept_count
- [ ] Lesson 09: Add stage/prerequisites/concept_count
- [ ] Validate YAML syntax on all files

### Phase 2-4: Content Refinement
- [ ] Lesson 2: Add "Why This Matters" section
- [ ] Lesson 4: Add "Why This Matters" + Three Roles example
- [ ] Lesson 5: Add "Why This Matters" + Three Roles + streamline
- [ ] Lesson 6: Reduce to 330-340 lines + "Why This Matters" + Three Roles (CRITICAL)
- [ ] Lesson 7: Add Three Roles step
- [ ] Lesson 8: Strengthen "Why This Matters" section
- [ ] Lesson 9: Reduce to 350-400 lines + "Why This Matters" (CRITICAL)
- [ ] README: Add Stage Progression section + diagram

### Phase 5: Validation
- [ ] Sandbox test: All installation methods (Lesson 2)
- [ ] Sandbox test: CLAUDE.md generation (Lesson 3)
- [ ] Sandbox test: MCP commands (Lesson 4)
- [ ] Sandbox test: `/agents` workflow (Lesson 5)
- [ ] Sandbox test: Skill creation and discovery (Lesson 6)
- [ ] Sandbox test: Hook creation and execution (Lesson 7)
- [ ] Sandbox test: Settings precedence (Lesson 8)
- [ ] Sandbox test: Plugin marketplace access and installation (Lesson 9)
- [ ] Create SANDBOX-AUDIT-REPORT.md
- [ ] Verify metadata consistency
- [ ] Validate README stage mapping aligns with lesson metadata

---

## Success Metrics

**Quantitative**:
- ✅ 9/9 lessons have complete metadata (stage, prerequisites, concept_count)
- ✅ Lesson 6 ≤340 lines, Lesson 9 ≤400 lines
- ✅ 5/9 lessons have explicit "Why This Matters" section
- ✅ 4/9 lessons (3,4,5,7) have enhanced Three Roles demonstrations
- ✅ 100% of code examples verified working in sandbox

**Qualitative**:
- ✅ README stage progression explicit and visual
- ✅ "Why This Matters" sections focus on methodology (not features)
- ✅ Three Roles examples demonstrate authentic co-learning
- ✅ Reduced lessons (6, 9) maintain learning objective clarity
- ✅ Chapter arc (L1→L2→L3→L4) is clear and traceable

**Pedagogical**:
- ✅ All concepts ≤7 (A2) or ≤10 (B1) per lesson
- ✅ Stage progression follows constitution (manual → collaboration → intelligence → spec-driven)
- ✅ All lessons map to success criteria from spec (SC1-SC7)

---

## Next Steps

1. **Review this plan** with pedagogical-designer for approval
2. **Execute Phase 1** (metadata) — low risk, high certainty
3. **Execute Phase 2** (easy refinements) — build momentum
4. **Execute Phase 3** (medium refinements) — moderate complexity
5. **Execute Phase 4** (critical reductions) — most careful, methodical work
6. **Execute Phase 5** (validation) — comprehensive testing before publication
7. **Generate tasks.md** via `/sp.tasks` for content-implementer execution

---

**This plan enables surgical, high-confidence refinement without rewriting. Each lesson has specific, measurable actions with clear validation criteria. Total effort: 14-19 hours distributed across 5 phases.**
